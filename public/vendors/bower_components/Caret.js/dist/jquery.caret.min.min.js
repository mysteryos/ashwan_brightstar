(function(d,c){if(typeof define==="function"&&define.amd){define(["jquery"],function(a){return(d.returnExportsGlobal=c(a))})}else{if(typeof exports==="object"){module.exports=c(require("jquery"))}else{c(jQuery)}}}(this,function(s){var o,m,x,p,t,u,r,n,w,q,v;q="caret";o=(function(){function a(b){this.$inputor=b;this.domInputor=this.$inputor[0]}a.prototype.setPos=function(b){return this.domInputor};a.prototype.getIEPosition=function(){return this.getPosition()};a.prototype.getPosition=function(){var c,b;b=this.getOffset();c=this.$inputor.offset();b.left-=c.left;b.top-=c.top;return b};a.prototype.getOldIEPos=function(){var b,c;c=r.selection.createRange();b=r.body.createTextRange();b.moveToElementText(this.domInputor);b.setEndPoint("EndToEnd",c);return b.text.length};a.prototype.getPos=function(){var d,b,c;if(c=this.range()){d=c.cloneRange();d.selectNodeContents(this.domInputor);d.setEnd(c.endContainer,c.endOffset);b=d.toString().length;d.detach();return b}else{if(r.selection){return this.getOldIEPos()}}};a.prototype.getOldIEOffset=function(){var c,b;c=r.selection.createRange().duplicate();c.moveStart("character",-1);b=c.getBoundingClientRect();return{height:b.bottom-b.top,left:b.left,top:b.top}};a.prototype.getOffset=function(b){var g,c,f,d,e;if(w.getSelection&&(f=this.range())){if(f.endOffset-1>0&&f.endContainer===!this.domInputor){g=f.cloneRange();g.setStart(f.endContainer,f.endOffset-1);g.setEnd(f.endContainer,f.endOffset);d=g.getBoundingClientRect();c={height:d.height,left:d.left+d.width,top:d.top};g.detach()}if(!c||(c!=null?c.height:void 0)===0){g=f.cloneRange();e=s(r.createTextNode("|"));g.insertNode(e[0]);g.selectNode(e[0]);d=g.getBoundingClientRect();c={height:d.height,left:d.left,top:d.top};e.remove();g.detach()}}else{if(r.selection){c=this.getOldIEOffset()}}if(c){c.top+=s(w).scrollTop();c.left+=s(w).scrollLeft()}return c};a.prototype.range=function(){var b;if(!w.getSelection){return}b=w.getSelection();if(b.rangeCount>0){return b.getRangeAt(0)}else{return null}};return a})();m=(function(){function a(b){this.$inputor=b;this.domInputor=this.$inputor[0]}a.prototype.getIEPos=function(){var e,c,g,d,b,f,h;c=this.domInputor;f=r.selection.createRange();b=0;if(f&&f.parentElement()===c){d=c.value.replace(/\r\n/g,"\n");g=d.length;h=c.createTextRange();h.moveToBookmark(f.getBookmark());e=c.createTextRange();e.collapse(false);if(h.compareEndPoints("StartToEnd",e)>-1){b=g}else{b=-h.moveStart("character",-g)}}return b};a.prototype.getPos=function(){if(r.selection){return this.getIEPos()}else{return this.domInputor.selectionStart}};a.prototype.setPos=function(b){var c,d;c=this.domInputor;if(r.selection){d=c.createTextRange();d.move("character",b);d.select()}else{if(c.setSelectionRange){c.setSelectionRange(b,b)}}return c};a.prototype.getIEOffset=function(b){var e,d,f,c;d=this.domInputor.createTextRange();b||(b=this.getPos());d.move("character",b);f=d.boundingLeft;c=d.boundingTop;e=d.boundingHeight;return{left:f,top:c,height:e}};a.prototype.getOffset=function(b){var d,c,e;d=this.$inputor;if(r.selection){c=this.getIEOffset(b);c.top+=s(w).scrollTop()+d.scrollTop();c.left+=s(w).scrollLeft()+d.scrollLeft();return c}else{c=d.offset();e=this.getPosition(b);return c={left:c.left+e.left-d.scrollLeft(),top:c.top+e.top-d.scrollTop(),height:e.height}}};a.prototype.getPosition=function(b){var d,c,h,e,g,f,i;d=this.$inputor;e=function(j){j=j.replace(/<|>|`|"|&/g,"?").replace(/\r\n|\r|\n/g,"<br/>");if(/firefox/i.test(navigator.userAgent)){j=j.replace(/\s/g,"&nbsp;")}return j};if(b===void 0){b=this.getPos()}i=d.val().slice(0,b);h=d.val().slice(b);g="<span style='position: relative; display: inline;'>"+e(i)+"</span>";g+="<span id='caret' style='position: relative; display: inline;'>|</span>";g+="<span style='position: relative; display: inline;'>"+e(h)+"</span>";f=new x(d);return c=f.create(g).rect()};a.prototype.getIEPosition=function(b){var f,c,e,g,d;e=this.getIEOffset(b);c=this.$inputor.offset();g=e.left-c.left;d=e.top-c.top;f=e.height;return{left:g,top:d,height:f}};return a})();x=(function(){a.prototype.css_attr=["borderBottomWidth","borderLeftWidth","borderRightWidth","borderTopStyle","borderRightStyle","borderBottomStyle","borderLeftStyle","borderTopWidth","boxSizing","fontFamily","fontSize","fontWeight","height","letterSpacing","lineHeight","marginBottom","marginLeft","marginRight","marginTop","outlineWidth","overflow","overflowX","overflowY","paddingBottom","paddingLeft","paddingRight","paddingTop","textAlign","textOverflow","textTransform","whiteSpace","wordBreak","wordWrap"];function a(b){this.$inputor=b}a.prototype.mirrorCss=function(){var c,b=this;c={position:"absolute",left:-9999,top:0,zIndex:-20000};if(this.$inputor.prop("tagName")==="TEXTAREA"){this.css_attr.push("width")}s.each(this.css_attr,function(e,d){return c[d]=b.$inputor.css(d)});return c};a.prototype.create=function(b){this.$mirror=s("<div></div>");this.$mirror.css(this.mirrorCss());this.$mirror.html(b);this.$inputor.after(this.$mirror);return this};a.prototype.rect=function(){var c,b,d;c=this.$mirror.find("#caret");b=c.position();d={left:b.left,top:b.top,height:c.height()};this.$mirror.remove();return d};return a})();p={contentEditable:function(a){return !!(a[0].contentEditable&&a[0].contentEditable==="true")}};u={pos:function(a){if(a||a===0){return this.setPos(a)}else{return this.getPos()}},position:function(a){if(r.selection){return this.getIEPosition(a)}else{return this.getPosition(a)}},offset:function(b){var a;a=this.getOffset(b);return a}};r=null;w=null;n=null;v=function(b){var a;if(a=b!=null?b.iframe:void 0){n=a;w=a.contentWindow;return r=a.contentDocument||w.document}else{n=void 0;w=window;return r=document}};t=function(a){var c;r=a[0].ownerDocument;w=r.defaultView||r.parentWindow;try{return n=w.frameElement}catch(b){c=b}};s.fn.caret=function(b,d,a){var c;if(u[b]){if(s.isPlainObject(d)){v(d);d=void 0}else{v(a)}c=p.contentEditable(this)?new o(this):new m(this);return u[b].apply(c,[d])}else{return s.error("Method "+b+" does not exist on jQuery.caret")}};s.fn.caret.EditableCaret=o;s.fn.caret.InputCaret=m;s.fn.caret.Utils=p;s.fn.caret.apis=u}));